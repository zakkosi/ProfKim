{
  "doc_id": "pages_503_505",
  "text": "10.2 High dynamic range imaging\n481\nposite (Burt and Kolczynski 1993; Mertens, Kautz, and Reeth 2007), this approach runs the\nrisk of creating contrast reversals and halos. Instead, the more common approach is to pro-\nceed in three stages:\n1. Estimate the radiometric response function from the aligned images.\n2. Estimate a radiance map by selecting or blending pixels from different exposures.\n3. Tone map the resulting high dynamic range (HDR) image back into a displayable\ngamut.\nThe idea behind estimating the radiometric response function is relatively straightforward\n(Mann and Picard 1995; Debevec and Malik 1997; Mitsunaga and Nayar 1999; Reinhard,\nWard, Pattanaik et al. 2005). Suppose you take three sets of images at different exposures\n(shutter speeds), say at ±2 exposure values.11 If we were able to determine the irradiance\n(exposure) Ei at each pixel (2.101), we could plot it against the measured pixel value zij for\neach exposure time tj, as shown in Figure 10.13.\nUnfortunately, we do not know the irradiance values Ei, so these have to be estimated\nat the same time as the radiometric response function f, which can be written (Debevec and\nMalik 1997) as\nzij = f(Ei tj),\n(10.3)\nwhere tj is the exposure time for the jth image. The inverse response curve f −1 is given by\nf −1(zij) = Ei tj.\n(10.4)\nTaking logarithms of both sides (base 2 is convenient, as we can now measure quantities in\nEVs), we obtain\ng(zij) = log f −1(zij) = log Ei + log tj,\n(10.5)\nwhere g = log f −1 (which maps pixel values zij into log irradiance) is the curve we are\nestimating (Figure 10.13 turned on its side).\nDebevec and Malik (1997) assume that the exposure times tj are known. (Recall that\nthese can be obtained from a camera’s EXIF tags, but that they actually follow a power of 2\nprogression . . . , 1/128, 1/64, 1/32, 1/16, 1/8, . . . instead of the marked . . . , 1/125, 1/60, 1/30,\n1/15, 1/8, . . . values—see Exercise 2.5.) The unknowns are therefore the per-pixel exposures\nEi and the response values gk = g(k), where g can be discretized according to the 256\npixel values commonly observed in eight-bit images. (The response curves are calibrated\nseparately for each color channel.)\n11 Changing the shutter speed is preferable to changing the aperture, as the latter can modify the vignetting and\nfocus. Using ±2 “f-stops” (technically, exposure values, or EVs, since f-stops refer to apertures) is usually the right\ncompromise between capturing a good dynamic range and having properly exposed pixels everywhere.\n482\nComputer Vision: Algorithms and Applications (September 3, 2010 draft)\nlog Exposure\nPixel value\n3\n1\n2\nlog Exposure\nPixel value\nFigure 10.13 Radiometric calibration using multiple exposures (Debevec and Malik 1997).\nCorresponding pixel values are plotted as functions of log exposures (irradiance). The curves\non the left are shifted to account for each pixel’s unknown radiance until they all line up into\na single smooth curve.\nIn order to make the response curve smooth, Debevec and Malik (1997) add a second-\norder smoothness constraint\nλ\nX\nk\ng′′(k)2 = λ\nX\n[g(k −1) −2g(k) + g(k + 1)]2,\n(10.6)\nwhich is similar to the one used in snakes (5.3). Since pixel values are more reliable in the\nmiddle of their range (and the g function becomes singular near saturation values), they also\nadd a weighting (hat) function w(k) that decays to zero at both ends of the pixel value range,\nw(z) =\n(\nz −zmin\nz ≤(zmin + zmax)/2\nzmax −z\nz > (zmin + zmax)/2.\n(10.7)\nPutting all of these terms together, they obtain a least squares problem in the unknowns\n{gk} and {Ei},\nE =\nX\ni\nX\nj\nw(zi,j)[g(zi,j) −log Ei −log tj]2 + λ\nX\nk\nw(k)g′′(k)2.\n(10.8)\n(In order to remove the overall shift ambiguity in the response curve and irradiance values,\nthe middle of the response curve is set to 0.) Debevec and Malik (1997) show how this can\nbe implemented in 21 lines of MATLAB code, which partially accounts for the popularity of\ntheir technique.\nWhile Debevec and Malik (1997) assume that the exposure times tj are known exactly,\nthere is no reason why these additional variables cannot be thrown into the least squares\nproblem, constraining their ﬁnal estimated values to lie close to their nominal values ˆtj with\nan extra term η P\nj(tj −ˆtj)2.\n10.2 High dynamic range imaging\n483\n(a)\n(b)\nFigure 10.14\nRecovered response function and radiance image for a real digital camera\n(DCS460) (Debevec and Malik 1997) c⃝1997 ACM.\nFigure 10.14 shows the recovered radiometric response function for a digital camera along\nwith select (relative) radiance values in the overall radiance map. Figure 10.15 shows the\nbracketed input images captured on color ﬁlm and the corresponding radiance map.\nWhile Debevec and Malik (1997) use a general second-order smooth curve g to parame-\nterize their response curve, Mann and Picard (1995) use a three-parameter function\nf(E) = α + βEγ,\n(10.9)\nwhile Mitsunaga and Nayar (1999) use a low-order (N ≤10) polynomial for the inverse\nresponse function g. Pal, Szeliski, Uyttendaele et al. (2004) derive a Bayesian model that\nestimates an independent smooth response function for each image, which can better model\nthe more sophisticated (and hence less predictable) automatic contrast and tone adjustment\nperformed in today’s digital cameras.\nOnce the response function has been estimated, the second step in creating high dynamic\nrange photographs is to merge the input images into a composite radiance map. If the re-\nsponse function and images were known exactly, i.e., if they were noise free, you could use\nany non-saturated pixel value to estimate the corresponding radiance by mapping it through\nthe inverse response curve E = g(z).\nUnfortunately, pixels are noisy, especially under low-light conditions when fewer photons\narrive at the sensor. To compensate for this, Mann and Picard (1995) use the derivative of\nthe response function as a weight in determining the ﬁnal radiance estimate, since “ﬂatter”\nregions of the curve tell us less about the incoming irradiance. Debevec and Malik (1997)\nuse a hat function (10.7) which accentuates mid-tone pixels while avoiding saturated values.\nMitsunaga and Nayar (1999) show that in order to maximize the signal-to-noise ratio (SNR),",
  "image_path": "page_504.jpg",
  "pages": [
    503,
    504,
    505
  ]
}