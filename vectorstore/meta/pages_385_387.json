{
  "doc_id": "pages_385_387",
  "text": "7.4 Bundle adjustment\n363\nfC(x)\n= Kx\nfj\nfP(x)\n= p/z\nfR(x)\n= Rjx\nqj\nfT(x)\n= x-cj\ncj\npi\ny(1)\ny(2)\ny(4)\nfRD(x)\n= ...\ny(3)\nκj\nρ(||x-xij||Σ)\neij\nΣij\nxij~\nxij\n^\n^\nFigure 7.7\nA set of chained transforms for projecting a 3D point pi into a 2D measure-\nment xij through a series of transformations f (k), each of which is controlled by its own\nset of parameters. The dashed lines indicate the ﬂow of information as partial derivatives\nare computed during a backward pass. The formula for the radial distortion function is\nf RD(x) = (1 + κ1r2 + κ2r4)x.\n7.4 Bundle adjustment\nAs we have mentioned several times before, the most accurate way to recover structure and\nmotion is to perform robust non-linear minimization of the measurement (re-projection) er-\nrors, which is commonly known in the photogrammetry (and now computer vision) commu-\nnities as bundle adjustment.13 Triggs, McLauchlan, Hartley et al. (1999) provide an excellent\noverview of this topic, including its historical development, pointers to the photogrammetry\nliterature (Slama 1980; Atkinson 1996; Kraus 1997), and subtle issues with gauge ambigu-\nities. The topic is also treated in depth in textbooks and surveys on multi-view geometry\n(Faugeras and Luong 2001; Hartley and Zisserman 2004; Moons, Van Gool, and Vergauwen\n2010).\nWe have already introduced the elements of bundle adjustment in our discussion on iter-\native pose estimation (Section 6.2.2), i.e., Equations (6.42–6.48) and Figure 6.5. The biggest\ndifference between these formulas and full bundle adjustment is that our feature location mea-\nsurements xij now depend not only on the point (track index) i but also on the camera pose\nindex j,\nxij = f(pi, Rj, cj, Kj),\n(7.49)\nand that the 3D point positions pi are also being simultaneously updated. In addition, it is\ncommon to add a stage for radial distortion parameter estimation (2.78),\nf RD(x) = (1 + κ1r2 + κ2r4)x,\n(7.50)\nif the cameras being used have not been pre-calibrated, as shown in Figure 7.7.\n13 The term ”bundle” refers to the bundles of rays connecting camera centers to 3D points and the term ”adjust-\nment” refers to the iterative minimization of re-projection error. Alternative terms for this in the vision community\ninclude optimal motion estimation (Weng, Ahuja, and Huang 1993) and non-linear least squares (Appendix A.3)\n(Taylor, Kriegman, and Anandan 1991; Szeliski and Kang 1994).\n364\nComputer Vision: Algorithms and Applications (September 3, 2010 draft)\nWhile most of the boxes (transforms) in Figure 7.7 have previously been explained (6.47),\nthe leftmost box has not. This box performs a robust comparison of the predicted and mea-\nsured 2D locations ˆxij and ˜xij after re-scaling by the measurement noise covariance Σij. In\nmore detail, this operation can be written as\nrij\n=\n˜xij −ˆxij,\n(7.51)\ns2\nij\n=\nrT\nijΣ−1\nij rij,\n(7.52)\neij\n=\nˆρ(s2\nij),\n(7.53)\nwhere ˆρ(r2) = ρ(r). The corresponding Jacobians (partial derivatives) can be written as\n∂eij\n∂s2\nij\n=\nˆρ′(s2\nij),\n(7.54)\n∂s2\nij\n∂˜xij\n=\nΣ−1\nij rij.\n(7.55)\nThe advantage of the chained representation introduced above is that it not only makes\nthe computations of the partial derivatives and Jacobians simpler but it can also be adapted\nto any camera conﬁguration. Consider for example a pair of cameras mounted on a robot\nthat is moving around in the world, as shown in Figure 7.8a. By replacing the rightmost\ntwo transformations in Figure 7.7 with the transformations shown in Figure 7.8b, we can\nsimultaneously recover the position of the robot at each time and the calibration of each\ncamera with respect to the rig, in addition to the 3D structure of the world.\n7.4.1 Exploiting sparsity\nLarge bundle adjustment problems, such as those involving reconstructing 3D scenes from\nthousands of Internet photographs (Snavely, Seitz, and Szeliski 2008b; Agarwal, Snavely,\nSimon et al. 2009; Agarwal, Furukawa, Snavely et al. 2010; Snavely, Simon, Goesele et al.\n2010), can require solving non-linear least squares problems with millions of measurements\n(feature matches) and tens of thousands of unknown parameters (3D point positions and cam-\nera poses). Unless some care is taken, these kinds of problem can become intractable, since\nthe (direct) solution of dense least squares problems is cubic in the number of unknowns.\nFortunately, structure from motion is a bipartite problem in structure and motion. Each\nfeature point xij in a given image depends on one 3D point position pi and one 3D camera\npose (Rj, cj). This is illustrated in Figure 7.9a, where each circle (1–9) indicates a 3D point,\neach square (A–D) indicates a camera, and lines (edges) indicate which points are visible in\nwhich cameras (2D features). If the values for all the points are known or ﬁxed, the equations\nfor all the cameras become independent, and vice versa.\n7.4 Bundle adjustment\n365\npi\nw\npi\nr\n(Rt\nr,ct\nr)\n(Rj\nc,cj\nc)\nY\nX\n(a)\nfR(x)\n= Rj\ncx\nqj\nc\nfT(x)\n= x-cj\nc\ncj\nc\ny(1)\ny(2)\nfR(x)\n= Rt\nrx\nqt\nr\nfT(x)\n= x-ct\nr\nct\nr\npi\nw\ny(0)\npi\nr\n…\n(b)\nFigure 7.8\nA camera rig and its associated transform chain. (a) As the mobile rig (robot)\nmoves around in the world, its pose with respect to the world at time t is captured by (Rr\nt, cr\nt).\nEach camera’s pose with respect to the rig is captured by (Rc\nj, cc\nj). (b) A 3D point with world\ncoordinates pw\ni is ﬁrst transformed into rig coordinates pr\ni, and then through the rest of the\ncamera-speciﬁc chain, as shown in Figure 7.7.\nA\nB\nC\nD\n1\n2\n3\n4\n5\n6\n7\n8\n9\n1\n2\n3\n4\n5\n6\n7\n8\n9\nA\nB\nC\nD\n1A\n1B\n2A\n2B\n3A\n3B\n4A\n4B\n4C\n5B\n5C\n6B\n6C\n7C\n7D\n8C\n8D\n9C\n9D\n1\n2\n3\n4\n5\n6\n7\n8\n9\nA\nB\nC\nD\n1\n2\n3\n4\n5\n6\n7\n8\n9\nA\nB\nC\nD\n(a)\n(b)\n(c)\nFigure 7.9\n(a) Bipartite graph for a toy structure from motion problem and (b) its associated\nJacobian J and (c) Hessian A. Numbers indicate 3D points and letters indicate cameras. The\ndashed arcs and light blue squares indicate the ﬁll-in that occurs when the structure (point)\nvariables are eliminated.",
  "image_path": "page_386.jpg",
  "pages": [
    385,
    386,
    387
  ]
}